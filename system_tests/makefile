

zawilinski=java -jar ../dist/zawilinski-1.0.3.jar


# Makefile.local should assign the name of the full wiktionary dump 
# to the variable $(fullDump)
include makefile.local

ifeq ($(suffix $(fullDump)), "bz2")
	readFullDump=bunzip2 -c $(fullDump)
else
	readFullDump=cat $(fullDump)
endif



# "expected" output is output that is generated through means other 
# than running Zawilinski (e.g., through grep or other scripts.)
# When updating Zawilinski, these files need not be regenerated.
expected=output/expected

# "observed" output is output generated by running Zawilinski.
# These output files must be regenerated whenever Zawilinski 
# is updated.
observed=output/observed


#scripts=scripts



#################################################################
#
# Test 1: Filter by Title can 
#     (a) Handle a full Wiktionary dump
#     (b) Finds all titles matching the listed regexps
#     (c) Finds only titles matching the listed regexp
#     (d) Interprets parameters as regular expressions
#
#  The basic idea is that we filter the full dump "by hand" 
#  using grep, then verify that Zawilin the samski selects e
#  pages.
#################################################################


# These patterns were chosen to (1) produce a relatively small output, and (2) use a variety of regexp features.
egrep_title_patterns='xyz|a.x|zo.+u.*u'
zawilinski_title_patterns=xyx a.x zo.+u.*u

$(expected)/filtered_title_list_from_egrep.txt: $(fullDump)
	$(readFullDump) | grep '<title>' | egrep $(egrep_title_patterns) > $@

$(observed)/filtered_by_title.txt: $(fullDump)
	$(zawilinski) Title $(fullDump) $(zawilinski_title_patterns) > $@

filter_by_title_saves_correct_articles: $(expected)/filtered_title_list_from_egrep.txt $(observed)/filtered_by_title.txt
	@echo "Running" $@
	@echo "   (Does Zawilinski find precisely the same articles as grep?)"	
	grep '<title>' $(observed)/filtered_by_title.txt | diff -w - $(expected)/filtered_title_list_from_egrep.txt
	@echo "Pass $@"

diffTest: output/abc.txt output/def.txt
	@echo -n ". "

	@diff output/abc.txt output/abc.txt
	@echo "Pass"




#all: $(outputDir)/countRevisions $(outputDir)/countLanguageRevisions_Polish $(outputDir)/countLanguageRevisions_French

# 
# $(outputDir)/countRevisions: $(scripts)/count_revisions.rb
# 	date
# 	echo "Running count_revisions"
# 	bunzip2 -c $(allArticles) | ruby $(scripts)/count_revisions.rb > $@
# 	date
# 
# $(outputDir)/countLanguageRevisions_Polish: $(scripts)/count_revisions.rb
# 	date
# 	echo "Running countRevisions"
# 	bunzip2 -c $(allArticles) | ruby $(scripts)/count_language_revisions.rb Polish> $@
# 	date
# 
# $(outputDir)/countLanguageRevisions_French: $(scripts)/count_language_revisions.rb
# 	date
# 	echo "Running countRevisions"
# 	bunzip2 -c $(allArticles) | ruby $(scripts)/count_language_revisions.rb French> $@
# 	date
# 

